{"version":3,"file":"sortable.esm.js","sources":["../src/utilities/arrayMove.ts","../src/utilities/getSortedRects.ts","../src/utilities/isValidIndex.ts","../src/strategies/horizontalListSorting.ts","../src/strategies/rectSorting.ts","../src/strategies/rectSwapping.ts","../src/strategies/verticalListSorting.ts","../src/components/SortableContext.tsx","../src/hooks/defaults.ts","../src/hooks/utilities/useDerivedTransform.ts","../src/hooks/useSortable.ts","../src/sensors/keyboard/sortableKeyboardCoordinates.ts"],"sourcesContent":["/**\n * Move an array item to a different position. Returns a new array with the item moved to the new position.\n */\nexport function arrayMove<T>(array: T[], from: number, to: number): T[] {\n  const newArray = array.slice();\n  newArray.splice(\n    to < 0 ? newArray.length + to : to,\n    0,\n    newArray.splice(from, 1)[0]\n  );\n\n  return newArray;\n}\n","import type {\n  LayoutRect,\n  UniqueIdentifier,\n  UseDndContextReturnValue,\n} from '@dnd-kit/core';\n\nexport function getSortedRects(\n  items: UniqueIdentifier[],\n  layoutRects: UseDndContextReturnValue['droppableRects']\n) {\n  return items.reduce<LayoutRect[]>((accumulator, id, index) => {\n    const layoutRect = layoutRects.get(id);\n\n    if (layoutRect) {\n      accumulator[index] = layoutRect;\n    }\n\n    return accumulator;\n  }, Array(items.length));\n}\n","export function isValidIndex(index: number | null): index is number {\n  return index !== null && index >= 0;\n}\n","import type {LayoutRect} from '@dnd-kit/core';\nimport type {SortingStrategy} from '../types';\n\n// To-do: We should be calculating scale transformation\nconst defaultScale = {\n  scaleX: 1,\n  scaleY: 1,\n};\n\nexport const horizontalListSortingStrategy: SortingStrategy = ({\n  layoutRects,\n  activeNodeRect: fallbackActiveRect,\n  activeIndex,\n  overIndex,\n  index,\n}) => {\n  const activeNodeRect = layoutRects[activeIndex] ?? fallbackActiveRect;\n\n  if (!activeNodeRect) {\n    return null;\n  }\n\n  const itemGap = getItemGap(layoutRects, index, activeIndex);\n\n  if (index === activeIndex) {\n    const newIndexRect = layoutRects[overIndex];\n\n    if (!newIndexRect) {\n      return null;\n    }\n\n    return {\n      x:\n        activeIndex < overIndex\n          ? newIndexRect.offsetLeft +\n            newIndexRect.width -\n            (activeNodeRect.offsetLeft + activeNodeRect.width)\n          : newIndexRect.offsetLeft - activeNodeRect.offsetLeft,\n      y: 0,\n      ...defaultScale,\n    };\n  }\n\n  if (index > activeIndex && index <= overIndex) {\n    return {\n      x: -activeNodeRect.width - itemGap,\n      y: 0,\n      ...defaultScale,\n    };\n  }\n\n  if (index < activeIndex && index >= overIndex) {\n    return {\n      x: activeNodeRect.width + itemGap,\n      y: 0,\n      ...defaultScale,\n    };\n  }\n\n  return {\n    x: 0,\n    y: 0,\n    ...defaultScale,\n  };\n};\n\nfunction getItemGap(\n  layoutRects: LayoutRect[],\n  index: number,\n  activeIndex: number\n) {\n  const currentRect = layoutRects[index];\n  const previousRect = layoutRects[index - 1];\n  const nextRect = layoutRects[index + 1];\n\n  if (!previousRect && !nextRect) {\n    return 0;\n  }\n\n  if (activeIndex < index) {\n    return previousRect\n      ? currentRect.offsetLeft - (previousRect.offsetLeft + previousRect.width)\n      : nextRect.offsetLeft - (currentRect.offsetLeft + currentRect.width);\n  }\n\n  return nextRect\n    ? nextRect.offsetLeft - (currentRect.offsetLeft + currentRect.width)\n    : currentRect.offsetLeft - (previousRect.offsetLeft + previousRect.width);\n}\n","import {arrayMove} from '../utilities';\nimport type {SortingStrategy} from '../types';\n\nexport const rectSortingStrategy: SortingStrategy = ({\n  layoutRects,\n  activeIndex,\n  overIndex,\n  index,\n}) => {\n  const newRects = arrayMove(layoutRects, overIndex, activeIndex);\n\n  const oldRect = layoutRects[index];\n  const newRect = newRects[index];\n\n  if (!newRect || !oldRect) {\n    return null;\n  }\n\n  return {\n    x: newRect.offsetLeft - oldRect.offsetLeft,\n    y: newRect.offsetTop - oldRect.offsetTop,\n    scaleX: newRect.width / oldRect.width,\n    scaleY: newRect.height / oldRect.height,\n  };\n};\n","import type {SortingStrategy} from '../types';\n\nexport const rectSwappingStrategy: SortingStrategy = ({\n  activeIndex,\n  index,\n  layoutRects,\n  overIndex,\n}) => {\n  let oldRect;\n  let newRect;\n\n  if (index === activeIndex) {\n    oldRect = layoutRects[index];\n    newRect = layoutRects[overIndex];\n  }\n\n  if (index === overIndex) {\n    oldRect = layoutRects[index];\n    newRect = layoutRects[activeIndex];\n  }\n\n  if (!newRect || !oldRect) {\n    return null;\n  }\n\n  return {\n    x: newRect.offsetLeft - oldRect.offsetLeft,\n    y: newRect.offsetTop - oldRect.offsetTop,\n    scaleX: newRect.width / oldRect.width,\n    scaleY: newRect.height / oldRect.height,\n  };\n};\n","import type {LayoutRect} from '@dnd-kit/core';\nimport type {SortingStrategy} from '../types';\n\n// To-do: We should be calculating scale transformation\nconst defaultScale = {\n  scaleX: 1,\n  scaleY: 1,\n};\n\nexport const verticalListSortingStrategy: SortingStrategy = ({\n  activeIndex,\n  activeNodeRect: fallbackActiveRect,\n  index,\n  layoutRects,\n  overIndex,\n}) => {\n  const activeNodeRect = layoutRects[activeIndex] ?? fallbackActiveRect;\n\n  if (!activeNodeRect) {\n    return null;\n  }\n\n  if (index === activeIndex) {\n    const overIndexRect = layoutRects[overIndex];\n\n    if (!overIndexRect) {\n      return null;\n    }\n\n    return {\n      x: 0,\n      y:\n        activeIndex < overIndex\n          ? overIndexRect.offsetTop +\n            overIndexRect.height -\n            (activeNodeRect.offsetTop + activeNodeRect.height)\n          : overIndexRect.offsetTop - activeNodeRect.offsetTop,\n      ...defaultScale,\n    };\n  }\n\n  const itemGap = getItemGap(layoutRects, index, activeIndex);\n\n  if (index > activeIndex && index <= overIndex) {\n    return {\n      x: 0,\n      y: -activeNodeRect.height - itemGap,\n      ...defaultScale,\n    };\n  }\n\n  if (index < activeIndex && index >= overIndex) {\n    return {\n      x: 0,\n      y: activeNodeRect.height + itemGap,\n      ...defaultScale,\n    };\n  }\n\n  return {\n    x: 0,\n    y: 0,\n    ...defaultScale,\n  };\n};\n\nfunction getItemGap(\n  layoutRects: LayoutRect[],\n  index: number,\n  activeIndex: number\n) {\n  const currentRect = layoutRects[index];\n  const previousRect = layoutRects[index - 1];\n  const nextRect = layoutRects[index + 1];\n\n  if (!currentRect) {\n    return 0;\n  }\n\n  if (activeIndex < index) {\n    return previousRect\n      ? currentRect.offsetTop - (previousRect.offsetTop + previousRect.height)\n      : nextRect\n      ? nextRect.offsetTop - (currentRect.offsetTop + currentRect.height)\n      : 0;\n  }\n\n  return nextRect\n    ? nextRect.offsetTop - (currentRect.offsetTop + currentRect.height)\n    : previousRect\n    ? currentRect.offsetTop - (previousRect.offsetTop + previousRect.height)\n    : 0;\n}\n","import React, {MutableRefObject, useEffect, useMemo, useRef} from 'react';\nimport {useDndContext, LayoutRect, UniqueIdentifier} from '@dnd-kit/core';\nimport {useIsomorphicLayoutEffect, useUniqueId} from '@dnd-kit/utilities';\n\nimport type {SortingStrategy} from '../types';\nimport {getSortedRects} from '../utilities';\nimport {rectSortingStrategy} from '../strategies';\n\nexport interface Props {\n  children: React.ReactNode;\n  items: (UniqueIdentifier | {id: UniqueIdentifier})[];\n  strategy?: SortingStrategy;\n  id?: string;\n}\n\nconst ID_PREFIX = 'Sortable';\n\ninterface ContextDescriptor {\n  activeIndex: number;\n  containerId: string;\n  disableTransforms: boolean;\n  items: UniqueIdentifier[];\n  overIndex: number;\n  useDragOverlay: boolean;\n  sortedRects: LayoutRect[];\n  strategy: SortingStrategy;\n  wasSorting: MutableRefObject<boolean>;\n}\n\nexport const Context = React.createContext<ContextDescriptor>({\n  activeIndex: -1,\n  containerId: ID_PREFIX,\n  disableTransforms: false,\n  items: [],\n  overIndex: -1,\n  useDragOverlay: false,\n  sortedRects: [],\n  strategy: rectSortingStrategy,\n  wasSorting: {current: false},\n});\n\nexport function SortableContext({\n  children,\n  id,\n  items: userDefinedItems,\n  strategy = rectSortingStrategy,\n}: Props) {\n  const {\n    active,\n    overlayNode,\n    droppableRects,\n    over,\n    recomputeLayouts,\n    willRecomputeLayouts,\n  } = useDndContext();\n  const containerId = useUniqueId(ID_PREFIX, id);\n  const useDragOverlay = Boolean(overlayNode.rect !== null);\n  const items = useMemo(\n    () =>\n      userDefinedItems.map((item) =>\n        typeof item === 'string' ? item : item.id\n      ),\n    [userDefinedItems]\n  );\n  const activeIndex = active ? items.indexOf(active.id) : -1;\n  const isSorting = activeIndex !== -1;\n  const wasSorting = useRef(isSorting);\n  const overIndex = over ? items.indexOf(over.id) : -1;\n  const previousItemsRef = useRef(items);\n  const sortedRects = getSortedRects(items, droppableRects);\n  const itemsHaveChanged = !isEqual(items, previousItemsRef.current);\n  const disableTransforms =\n    (overIndex !== -1 && activeIndex === -1) || itemsHaveChanged;\n\n  useIsomorphicLayoutEffect(() => {\n    if (itemsHaveChanged && isSorting && !willRecomputeLayouts) {\n      // To-do: Add partial recompution of only subset of rects\n      recomputeLayouts();\n    }\n  }, [itemsHaveChanged, isSorting, recomputeLayouts, willRecomputeLayouts]);\n\n  useEffect(() => {\n    previousItemsRef.current = items;\n  }, [items]);\n\n  useEffect(() => {\n    requestAnimationFrame(() => {\n      wasSorting.current = isSorting;\n    });\n  }, [isSorting]);\n\n  const contextValue = useMemo(\n    (): ContextDescriptor => ({\n      activeIndex,\n      containerId,\n      disableTransforms,\n      items,\n      overIndex,\n      useDragOverlay,\n      sortedRects,\n      strategy,\n      wasSorting,\n    }),\n    [\n      activeIndex,\n      containerId,\n      disableTransforms,\n      items,\n      overIndex,\n      sortedRects,\n      useDragOverlay,\n      strategy,\n      wasSorting,\n    ]\n  );\n\n  return <Context.Provider value={contextValue}>{children}</Context.Provider>;\n}\n\nfunction isEqual(arr1: string[], arr2: string[]) {\n  return arr1.join() === arr2.join();\n}\n","import {CSS} from '@dnd-kit/utilities';\n\nimport type {AnimateLayoutChanges, SortableTransition} from './types';\n\nexport const defaultAnimateLayoutChanges: AnimateLayoutChanges = ({\n  isSorting,\n  index,\n  newIndex,\n  transition,\n}) => {\n  if (!transition) {\n    return false;\n  }\n\n  if (isSorting) {\n    return true;\n  }\n\n  return newIndex !== index;\n};\n\nexport const defaultTransition: SortableTransition = {\n  duration: 200,\n  easing: 'ease',\n};\n\nexport const transitionProperty = 'transform';\n\nexport const disabledTransition = CSS.Transition.toString({\n  property: transitionProperty,\n  duration: 0,\n  easing: 'linear',\n});\n\nexport const defaultAttributes = {\n  roleDescription: 'sortable',\n};\n","import {useEffect, useRef, useState} from 'react';\nimport {getBoundingClientRect, LayoutRect} from '@dnd-kit/core';\nimport type {Transform} from '@dnd-kit/utilities';\n\ninterface Arguments {\n  rect: React.MutableRefObject<LayoutRect | null>;\n  disabled: boolean;\n  index: number;\n  node: React.MutableRefObject<HTMLElement | null>;\n}\n\n/*\n * When the index of an item changes while sorting,\n * we need to temporarily disable the transforms\n */\nexport function useDerivedTransform({rect, disabled, index, node}: Arguments) {\n  const [derivedTransform, setDerivedtransform] = useState<Transform | null>(\n    null\n  );\n  const prevIndex = useRef(index);\n\n  useEffect(() => {\n    if (!disabled && index !== prevIndex.current && node.current) {\n      const initial = rect.current;\n\n      if (initial) {\n        const current = getBoundingClientRect(node.current);\n        const delta = {\n          x: initial.offsetLeft - current.offsetLeft,\n          y: initial.offsetTop - current.offsetTop,\n          scaleX: initial.width / current.width,\n          scaleY: initial.height / current.height,\n        };\n\n        if (delta.x || delta.y) {\n          setDerivedtransform(delta);\n        }\n      }\n    }\n\n    if (index !== prevIndex.current) {\n      prevIndex.current = index;\n    }\n  }, [disabled, index, node, rect]);\n\n  useEffect(() => {\n    if (derivedTransform) {\n      requestAnimationFrame(() => {\n        setDerivedtransform(null);\n      });\n    }\n  }, [derivedTransform]);\n\n  return derivedTransform;\n}\n","import {useContext, useEffect, useMemo, useRef} from 'react';\nimport {useDraggable, useDroppable, UseDraggableArguments} from '@dnd-kit/core';\nimport {CSS, useCombinedRefs} from '@dnd-kit/utilities';\n\nimport {Context} from '../components';\nimport type {SortingStrategy} from '../types';\nimport {arrayMove, isValidIndex} from '../utilities';\nimport {\n  defaultAnimateLayoutChanges,\n  defaultAttributes,\n  defaultTransition,\n  disabledTransition,\n  transitionProperty,\n} from './defaults';\nimport type {AnimateLayoutChanges, SortableTransition} from './types';\nimport {useDerivedTransform} from './utilities';\n\nexport interface Arguments extends UseDraggableArguments {\n  animateLayoutChanges?: AnimateLayoutChanges;\n  strategy?: SortingStrategy;\n  transition?: SortableTransition | null;\n}\n\nexport function useSortable({\n  animateLayoutChanges = defaultAnimateLayoutChanges,\n  attributes: userDefinedAttributes,\n  disabled,\n  data: customData,\n  id,\n  strategy: localStrategy,\n  transition = defaultTransition,\n}: Arguments) {\n  const {\n    items,\n    containerId,\n    activeIndex,\n    disableTransforms,\n    sortedRects,\n    overIndex,\n    useDragOverlay,\n    strategy: globalStrategy,\n    wasSorting,\n  } = useContext(Context);\n  const index = items.indexOf(id);\n  const data = useMemo(\n    () => ({sortable: {containerId, index, items}, ...customData}),\n    [containerId, customData, index, items]\n  );\n  const {rect, node, setNodeRef: setDroppableNodeRef} = useDroppable({\n    id,\n    data,\n  });\n  const {\n    active,\n    activeNodeRect,\n    activatorEvent,\n    attributes,\n    setNodeRef: setDraggableNodeRef,\n    listeners,\n    isDragging,\n    over,\n    transform,\n  } = useDraggable({\n    id,\n    data,\n    attributes: {\n      ...defaultAttributes,\n      ...userDefinedAttributes,\n    },\n    disabled,\n  });\n  const setNodeRef = useCombinedRefs(setDroppableNodeRef, setDraggableNodeRef);\n  const isSorting = Boolean(active);\n  const displaceItem =\n    isSorting &&\n    wasSorting.current &&\n    !disableTransforms &&\n    isValidIndex(activeIndex) &&\n    isValidIndex(overIndex);\n  const shouldDisplaceDragSource = !useDragOverlay && isDragging;\n  const dragSourceDisplacement =\n    shouldDisplaceDragSource && displaceItem ? transform : null;\n  const strategy = localStrategy ?? globalStrategy;\n  const finalTransform = displaceItem\n    ? dragSourceDisplacement ??\n      strategy({\n        layoutRects: sortedRects,\n        activeNodeRect,\n        activeIndex,\n        overIndex,\n        index,\n      })\n    : null;\n  const newIndex =\n    isValidIndex(activeIndex) && isValidIndex(overIndex)\n      ? arrayMove(items, activeIndex, overIndex).indexOf(id)\n      : index;\n  const prevNewIndex = useRef(newIndex);\n  const shouldAnimateLayoutChanges = animateLayoutChanges({\n    active,\n    isDragging,\n    isSorting,\n    id,\n    index,\n    items,\n    newIndex: prevNewIndex.current,\n    transition,\n    wasSorting: wasSorting.current,\n  });\n  const derivedTransform = useDerivedTransform({\n    disabled: !shouldAnimateLayoutChanges,\n    index,\n    node,\n    rect,\n  });\n\n  useEffect(() => {\n    if (isSorting) {\n      prevNewIndex.current = newIndex;\n    }\n  }, [isSorting, newIndex]);\n\n  return {\n    active,\n    attributes,\n    activatorEvent,\n    rect,\n    index,\n    isSorting,\n    isDragging,\n    listeners,\n    node,\n    overIndex,\n    over,\n    setNodeRef,\n    setDroppableNodeRef,\n    setDraggableNodeRef,\n    transform: derivedTransform ?? finalTransform,\n    transition: getTransition(),\n  };\n\n  function getTransition() {\n    if (derivedTransform) {\n      // Temporarily disable transitions for a single frame to set up derived transforms\n      return disabledTransition;\n    }\n\n    if (shouldDisplaceDragSource || !transition) {\n      return null;\n    }\n\n    if (isSorting || shouldAnimateLayoutChanges) {\n      return CSS.Transition.toString({\n        ...transition,\n        property: transitionProperty,\n      });\n    }\n\n    return null;\n  }\n}\n","import {\n  closestCorners,\n  getViewRect,\n  getScrollableAncestors,\n  KeyboardCode,\n  RectEntry,\n  KeyboardCoordinateGetter,\n} from '@dnd-kit/core';\n\nconst directions: string[] = [\n  KeyboardCode.Down,\n  KeyboardCode.Right,\n  KeyboardCode.Up,\n  KeyboardCode.Left,\n];\n\nexport const sortableKeyboardCoordinates: KeyboardCoordinateGetter = (\n  event,\n  {context: {droppableContainers, translatedRect, scrollableAncestors}}\n) => {\n  if (directions.includes(event.code)) {\n    event.preventDefault();\n\n    if (!translatedRect) {\n      return;\n    }\n\n    const layoutRects: RectEntry[] = [];\n\n    Object.entries(droppableContainers).forEach(([id, container]) => {\n      if (container?.disabled) {\n        return;\n      }\n\n      const node = container?.node.current;\n\n      if (!node) {\n        return;\n      }\n\n      const rect = getViewRect(node);\n\n      switch (event.code) {\n        case KeyboardCode.Down:\n          if (translatedRect.top + translatedRect.height <= rect.top) {\n            layoutRects.push([id, rect]);\n          }\n          break;\n        case KeyboardCode.Up:\n          if (translatedRect.top >= rect.top + rect.height) {\n            layoutRects.push([id, rect]);\n          }\n          break;\n        case KeyboardCode.Left:\n          if (translatedRect.left >= rect.left + rect.width) {\n            layoutRects.push([id, rect]);\n          }\n          break;\n        case KeyboardCode.Right:\n          if (translatedRect.left + translatedRect.width <= rect.left) {\n            layoutRects.push([id, rect]);\n          }\n          break;\n      }\n    });\n\n    const closestId = closestCorners(layoutRects, translatedRect);\n\n    if (closestId) {\n      const newNode = droppableContainers[closestId]?.node.current;\n\n      if (newNode) {\n        const newScrollAncestors = getScrollableAncestors(newNode);\n        const hasDifferentScrollAncestors = newScrollAncestors.some(\n          (element, index) => scrollableAncestors[index] !== element\n        );\n        const newRect = getViewRect(newNode);\n        const offset = hasDifferentScrollAncestors\n          ? {\n              x: 0,\n              y: 0,\n            }\n          : {\n              x: translatedRect.width - newRect.width,\n              y: translatedRect.height - newRect.height,\n            };\n        const newCoordinates = {\n          x: newRect.left - offset.x,\n          y: newRect.top - offset.y,\n        };\n\n        return newCoordinates;\n      }\n    }\n  }\n\n  return undefined;\n};\n"],"names":["arrayMove","array","from","to","newArray","slice","splice","length","getSortedRects","items","layoutRects","reduce","accumulator","id","index","layoutRect","get","Array","isValidIndex","defaultScale","scaleX","scaleY","horizontalListSortingStrategy","activeNodeRect","fallbackActiveRect","activeIndex","overIndex","itemGap","getItemGap","newIndexRect","x","offsetLeft","width","y","currentRect","previousRect","nextRect","rectSortingStrategy","newRects","oldRect","newRect","offsetTop","height","rectSwappingStrategy","verticalListSortingStrategy","overIndexRect","ID_PREFIX","Context","React","createContext","containerId","disableTransforms","useDragOverlay","sortedRects","strategy","wasSorting","current","SortableContext","children","userDefinedItems","active","overlayNode","droppableRects","over","recomputeLayouts","willRecomputeLayouts","useDndContext","useUniqueId","Boolean","rect","useMemo","map","item","indexOf","isSorting","useRef","previousItemsRef","itemsHaveChanged","isEqual","useIsomorphicLayoutEffect","useEffect","requestAnimationFrame","contextValue","Provider","value","arr1","arr2","join","defaultAnimateLayoutChanges","newIndex","transition","defaultTransition","duration","easing","transitionProperty","disabledTransition","CSS","Transition","toString","property","defaultAttributes","roleDescription","useDerivedTransform","disabled","node","derivedTransform","setDerivedtransform","useState","prevIndex","initial","getBoundingClientRect","delta","useSortable","animateLayoutChanges","attributes","userDefinedAttributes","data","customData","localStrategy","globalStrategy","useContext","sortable","setNodeRef","setDroppableNodeRef","useDroppable","activatorEvent","setDraggableNodeRef","listeners","isDragging","transform","useDraggable","useCombinedRefs","displaceItem","shouldDisplaceDragSource","dragSourceDisplacement","finalTransform","prevNewIndex","shouldAnimateLayoutChanges","getTransition","directions","KeyboardCode","Down","Right","Up","Left","sortableKeyboardCoordinates","event","context","droppableContainers","translatedRect","scrollableAncestors","includes","code","preventDefault","Object","entries","forEach","container","getViewRect","top","push","left","closestId","closestCorners","newNode","newScrollAncestors","getScrollableAncestors","hasDifferentScrollAncestors","some","element","offset","newCoordinates","undefined"],"mappings":"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"}